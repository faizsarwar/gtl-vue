{"ast":null,"code":"import axios from 'axios';\nimport CartItem from '@/components/CartItem.vue';\nexport default {\n  name: 'Checkout',\n  components: {\n    CartItem\n  },\n\n  data() {\n    return {\n      cart: {\n        items: []\n      },\n      stripe: {},\n      card: {},\n      first_name: '',\n      last_name: '',\n      email: '',\n      phone: '',\n      address: '',\n      zipcode: '',\n      place: '',\n      errors: []\n    };\n  },\n\n  mounted() {\n    document.title = 'Checkout | Anasazi';\n    this.cart = this.$store.state.cart;\n\n    if (this.cartTotalLength > 0) {\n      this.stripe = Stripe('pk_test_51KfMtDCo5tQGz5JpkIZmtwCH9xiGit1BV4ONCSTQoDXWApnsZ9VGG59uhPQSZPT0jcQmBCr0cuUF2wxDdwdOffIK00S6Ww2xer');\n      const elements = this.stripe.elements();\n      this.card = elements.create('card', {\n        hidePostalCode: true\n      });\n      this.card.mount('#card-element');\n    }\n  },\n\n  methods: {\n    getItemTotal(item) {\n      return item.quantity * item.price;\n    },\n\n    submitForm() {\n      this.errors = [];\n\n      if (this.first_name === '') {\n        this.errors.push('The first name field is missing!');\n      }\n\n      if (this.last_name === '') {\n        this.errors.push('The last name field is missing!');\n      }\n\n      if (this.email === '') {\n        this.errors.push('The email field is missing!');\n      }\n\n      if (this.phone === '') {\n        this.errors.push('The phone field is missing!');\n      }\n\n      if (this.address === '') {\n        this.errors.push('The address field is missing!');\n      }\n\n      if (this.zipcode === '') {\n        this.errors.push('The zip code field is missing!');\n      }\n\n      if (this.place === '') {\n        this.errors.push('The place field is missing!');\n      }\n\n      if (!this.errors.length) {\n        this.$store.commit('setIsLoading', true);\n        this.stripe.createToken(this.card).then(result => {\n          if (result.error) {\n            this.$store.commit('setIsLoading', false);\n            this.errors.push('Something went wrong with Stripe. Please try again');\n            console.log(\"error is this\", result.error.message);\n          } else {\n            this.stripeTokenHandler(result.token);\n          }\n        });\n      }\n    },\n\n    async stripeTokenHandler(token) {\n      console.log(\"hello\");\n      const items = [];\n\n      for (let i = 0; i < this.cart.items.length; i++) {\n        const item = this.cart.items[i];\n        const obj = {\n          product: item.product.id,\n          quantity: item.quantity,\n          price: item.price * item.quantity\n        };\n        items.push(obj);\n      }\n\n      const data = {\n        'first_name': this.first_name,\n        'last_name': this.last_name,\n        'email': this.email,\n        'address': this.address,\n        'zipcode': this.zipcode,\n        'place': this.place,\n        'phone': this.phone,\n        'stripe_token': token.id,\n        'items': items\n      };\n      await axios.post('/api/v1/checkout/', data).then(response => {\n        this.$store.commit('clearCart');\n        this.$router.push('/success');\n      }).catch(error => {\n        this.errors.push('Something went wrong. Please try again');\n        console.log(error, \"err0or 2\");\n      });\n      this.$store.commit('setIsLoading', false);\n    }\n\n  },\n  computed: {\n    cartTotalPrice() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return acc += curVal.price * curVal.quantity;\n      }, 0);\n    },\n\n    cartTotalLength() {\n      return this.cart.items.reduce((acc, curVal) => {\n        return acc += curVal.quantity;\n      }, 0);\n    }\n\n  }\n};","map":{"version":3,"mappings":"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","names":["axios","CartItem","name","components","data","cart","items","stripe","card","first_name","last_name","email","phone","address","zipcode","place","errors","mounted","document","title","$store","state","cartTotalLength","Stripe","elements","create","hidePostalCode","mount","methods","getItemTotal","item","quantity","price","submitForm","push","length","commit","createToken","then","result","error","console","log","message","stripeTokenHandler","token","i","obj","product","id","post","response","$router","catch","computed","cartTotalPrice","reduce","acc","curVal"],"sourceRoot":"","sources":["/home/faiz/Anas-Defy/glass-vue/src/views/checkout.vue"],"sourcesContent":["<template>\n    <div class=\"page-checkout p-0 mt-0 mb-0\">\n        <div class=\"columns is-multiline\">\n            <div class=\"column is-12\">\n                <h1 class=\"heading\">Checkout</h1>\n            </div>\n\n            <div class=\"column is-12 box\">\n                <table class=\"table is-fullwidth\" v-if=\"cartTotalLength\">\n                    <thead>\n                        <tr>\n                            <th>Product</th>\n                            <th>size</th>\n                            <th>Price</th>\n                            <th>Quantity</th>\n                            <th>Total</th>\n                            <th></th>\n                        </tr>\n                    </thead>\n\n\n\n                    <tbody>\n                        <CartItem\n                            v-for=\"item in cart.items\"\n                            v-bind:key=\"item.product.id\"\n                            v-bind:initialItem=\"item\"\n                            v-on:removeFromCart=\"removeFromCart\" />\n                    </tbody>\n            \n                    <tfoot>\n                        <tr>\n                            <td colspan=\"2\">Total</td>\n                            <td></td>\n                            <td>{{ cartTotalLength }}</td>\n                            <td>${{ cartTotalPrice.toFixed(2) }}</td>\n                        </tr>\n                    </tfoot>\n                </table>\n            </div>\n\n            <div class=\"column is-12 box\">\n                <h2 class=\"heading mt-5\">Shipping details</h2>\n\n                <p class=\"has-text-grey mb-4\">* All fields are required</p>\n    <!--  -->\n            <div class=\"ml-5 mr-5\">\n                <div class=\"form-row\">\n                    <div class=\"form-group col-md-6\">\n                    <p for=\"inputEmail4\" class=\"form-label\">Email</p>\n                    <input type=\"email\" class=\"form-control\" id=\"inputEmail4\" placeholder=\"Email\" v-model=\"email\">\n                    </div>\n                    <div class=\"form-group col-md-6\">\n                    <p for=\"inputPassword4 \" class=\"form-label\">Phone</p>\n                    <input type=\"text\" class=\"form-control\" id=\"inputPassword4\" placeholder=\"Phone Number\" v-model=\"phone\">\n                    </div>\n                </div>\n                    <div class=\"form-row\">\n                    <div class=\"form-group col\" >\n                    <p for=\"inputCity\" class=\"form-label\">First Name</p>\n                    <input type=\"text\" class=\"form-control\" id=\"inputCity\" v-model=\"first_name\">\n                    </div>\n                    <div class=\"form-group col\">\n                    <p for=\"inputCity\" class=\"form-label\">Last Name</p>\n                    <input type=\"text\" class=\"form-control\" id=\"inputCity\" v-model=\"last_name\">\n                    </div>\n                    <div class=\"form-group col\">\n                    <p for=\"inputZip\" class=\"form-label\">Zip</p>\n                    <input type=\"text\" class=\"form-control\" id=\"inputZip\"  v-model=\"zipcode\">\n                    </div>\n                </div>\n                <div class=\"form-group\">\n                    <p for=\"inputAddress\" class=\"form-label\">Address</p>\n                    <input type=\"text\" class=\"form-control\" id=\"inputAddress\" placeholder=\"1234 Main St\" v-model=\"address\">\n                </div>\n                <div class=\"form-group\">\n                    <p for=\"inputAddress2\" class=\"form-label\">Place</p>\n                    <input type=\"text\" class=\"form-control\" id=\"inputAddress2\" placeholder=\"Apartment, studio, or floor\" v-model=\"place\">\n                </div>\n    <!--  -->\n                <div class=\"notification bg-danger mt-4\" style=\"color: white\" v-if=\"errors.length\">\n                    <p v-for=\"error in errors\" v-bind:key=\"error\">{{ error }}</p>\n                </div>\n\n                <hr>\n\n                <div id=\"card-element\" class=\"m-5\"></div>\n                <div v-if=\"cartTotalLength\">\n\n                    <button class=\"btn btn btn-success mt-3 mb-3\" @click=\"submitForm\">Pay with Stripe</button>\n                </div>\n                <!--  -->\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport CartItem from '@/components/CartItem.vue'\nexport default {\n    name: 'Checkout',\n    components: {\n        CartItem,\n    },\n    data() {\n        return {\n            cart: {\n                items: []\n            },\n            stripe: {},\n            card: {},\n            first_name: '',\n            last_name: '',\n            email: '',\n            phone: '',\n            address: '',\n            zipcode: '',\n            place: '',\n            errors: []\n        }\n    },\n    mounted() {\n        document.title = 'Checkout | Anasazi'\n        this.cart = this.$store.state.cart\n        if (this.cartTotalLength > 0) {\n            this.stripe = Stripe('pk_test_51KfMtDCo5tQGz5JpkIZmtwCH9xiGit1BV4ONCSTQoDXWApnsZ9VGG59uhPQSZPT0jcQmBCr0cuUF2wxDdwdOffIK00S6Ww2xer')\n            const elements = this.stripe.elements();\n            this.card = elements.create('card', { hidePostalCode: true })\n            this.card.mount('#card-element')\n        }\n    },\n    methods: {\n        getItemTotal(item) {\n            return item.quantity * item.price\n        },\n        submitForm() {\n            this.errors = []\n            if (this.first_name === '') {\n                this.errors.push('The first name field is missing!')\n            }\n            if (this.last_name === '') {\n                this.errors.push('The last name field is missing!')\n            }\n            if (this.email === '') {\n                this.errors.push('The email field is missing!')\n            }\n            if (this.phone === '') {\n                this.errors.push('The phone field is missing!')\n            }\n            if (this.address === '') {\n                this.errors.push('The address field is missing!')\n            }\n            if (this.zipcode === '') {\n                this.errors.push('The zip code field is missing!')\n            }\n            if (this.place === '') {\n                this.errors.push('The place field is missing!')\n            }\n            if (!this.errors.length) {\n                this.$store.commit('setIsLoading', true)\n                this.stripe.createToken(this.card).then(result => {                    \n                    if (result.error) {\n                        this.$store.commit('setIsLoading', false)\n                        this.errors.push('Something went wrong with Stripe. Please try again')\n                        console.log( \"error is this\", result.error.message)\n                    } else {\n                        this.stripeTokenHandler(result.token)\n                    }\n                })\n            }\n        },\n        async stripeTokenHandler(token) {\n            console.log(\"hello\")\n            const items = []\n            for (let i = 0; i < this.cart.items.length; i++) {\n                const item = this.cart.items[i]\n                const obj = {\n                    product: item.product.id,\n                    quantity: item.quantity,\n                    price: item.price * item.quantity\n                }\n                items.push(obj)\n            }\n            const data = {\n                'first_name': this.first_name,\n                'last_name': this.last_name,\n                'email': this.email,\n                'address': this.address,\n                'zipcode': this.zipcode,\n                'place': this.place,\n                'phone': this.phone,\n                'stripe_token': token.id,\n                'items': items,\n            }\n            await axios\n                .post('/api/v1/checkout/', data)\n                .then(response => {\n                    this.$store.commit('clearCart')\n                    this.$router.push('/success')\n                })\n                .catch(error => {\n                    this.errors.push('Something went wrong. Please try again')\n                    console.log(error, \"err0or 2\")\n                })\n                this.$store.commit('setIsLoading', false)\n        }\n    },\n    computed: {\n        cartTotalPrice() {\n            return this.cart.items.reduce((acc, curVal) => {\n                return acc += curVal.price * curVal.quantity\n            }, 0)\n        },\n        cartTotalLength() {\n            return this.cart.items.reduce((acc, curVal) => {\n                return acc += curVal.quantity\n            }, 0)\n        }\n    }\n}\n</script>\n<style scoped>\n.form-label {\n  /* display: inline-block;\n  width: 140px; */\n  margin-bottom: 2px;\n  text-align: left;\n  color: green;\n}\n</style>"]},"metadata":{},"sourceType":"module"}